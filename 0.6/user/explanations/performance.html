
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How fast can we write HDF files? &#8212; PandABlocks-client 0.6 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>

    <script src="../../_static/documentation_options.js?v=ec806d2c"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=30646c52"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/explanations/performance';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://PandABlocks.github.io/PandABlocks-client/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '0.6';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/PandA-logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Why write a Sans-IO library?" href="sans-io.html" />
    <link rel="prev" title="About the documentation" href="docs-structure.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/PandA-logo-for-black-background.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../_static/PandA-logo-for-black-background.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">PandABlocks-client</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/PandABlocks/PandABlocks-client/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PandABlocks/PandABlocks-client" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/PandABlocks-client" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/PandABlocks/PandABlocks-client/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PandABlocks/PandABlocks-client" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/PandABlocks-client" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/commandline-hdf.html">Commandline Capture of HDF Files Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/control.html">Interactive Control Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/load-save.html">Commandline Load/Save Tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how-to/run-container.html">Run in a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/introspect-panda.html">How to introspect a PandA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/library-hdf.html">How to use the library to capture HDF files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how-to/poll-changes.html">How to efficiently poll for changes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="docs-structure.html">About the documentation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How fast can we write HDF files?</a></li>
<li class="toctree-l1"><a class="reference internal" href="sans-io.html">Why write a Sans-IO library?</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">How fast...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="how-fast-can-we-write-hdf-files">
<span id="performance"></span><h1>How fast can we write HDF files?<a class="headerlink" href="#how-fast-can-we-write-hdf-files" title="Link to this heading">#</a></h1>
<p>There are many factors that affect the speed we can write HDF files. This article
discusses how this library addresses them and what the maximum data rate of a PandA is.</p>
<section id="factors-to-consider">
<h2>Factors to consider<a class="headerlink" href="#factors-to-consider" title="Link to this heading">#</a></h2>
<table class="table">
<colgroup>
<col style="width: 16.7%" />
<col style="width: 83.3%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Trigger frequency</p></td>
<td><p>Each trigger will send all the captured fields, so the higher the trigger
frequency the more data is sent</p></td>
</tr>
<tr class="row-even"><td><p>Fields captured</p></td>
<td><p>Both the number of fields captured and their capture types affect the data
sent on each trigger</p></td>
</tr>
<tr class="row-odd"><td><p>Sample format and processing</p></td>
<td><p>Server side format and processing of each sample affects the data volume.
Framed format is selected by this library, with raw or scaled data
processing available.</p></td>
</tr>
<tr class="row-even"><td><p>Network speed</p></td>
<td><p>1 Gigabit ethernet should be used to maximise throughput</p></td>
</tr>
<tr class="row-odd"><td><p>File system speed</p></td>
<td><p>Some local disks and NFS mounts may not be fast enough to sustain
maximum data rate.</p></td>
</tr>
<tr class="row-even"><td><p>CPU load on the PandA</p></td>
<td><p>Excessive CPU load on the PandA, generated by extra TCP server clients
or panda-webcontrol will reduce throughput</p></td>
</tr>
<tr class="row-odd"><td><p>Flush rate</p></td>
<td><p>Flushing data to disk to often will slow write speed</p></td>
</tr>
</tbody>
</table>
</section>
<section id="strategies-to-help">
<h2>Strategies to help<a class="headerlink" href="#strategies-to-help" title="Link to this heading">#</a></h2>
<p>There are a number of strategies that help increase performance. These can be
combined to give the greatest benefit</p>
<section id="average-the-data">
<h3>Average the data<a class="headerlink" href="#average-the-data" title="Link to this heading">#</a></h3>
<p>Selecting the <code class="docutils literal notranslate"><span class="pre">Mean</span></code> capture mode will activate on-FPGA averaging of the
captured value. <code class="docutils literal notranslate"><span class="pre">Min</span></code> and <code class="docutils literal notranslate"><span class="pre">Max</span></code> can also be captured at the same time.
Capturing these rather than <code class="docutils literal notranslate"><span class="pre">Value</span></code> may allow you to lower the trigger
frequency while still providing enough information for data analysis</p>
</section>
<section id="scale-the-data-on-the-client">
<h3>Scale the data on the client<a class="headerlink" href="#scale-the-data-on-the-client" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api.html#pandablocks.asyncio.AsyncioClient.data" title="pandablocks.asyncio.AsyncioClient.data"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">AsyncioClient.data</span></code></a> and <a class="reference internal" href="../reference/api.html#pandablocks.blocking.BlockingClient.data" title="pandablocks.blocking.BlockingClient.data"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">BlockingClient.data</span></code></a> accept a <code class="docutils literal notranslate"><span class="pre">scaled</span></code> argument.
Setting this to False will transfer the raw unscaled data, allowing for up to
50% more data to be sent depending on the datatype of the field. You can
use the <a class="reference internal" href="../reference/api.html#pandablocks.responses.StartData.fields" title="pandablocks.responses.StartData.fields"><code class="xref any py py-attr docutils literal notranslate"><span class="pre">StartData.fields</span></code></a> information to scale the data on the client.
The <a class="reference internal" href="../reference/api.html#pandablocks.hdf.write_hdf_files" title="pandablocks.hdf.write_hdf_files"><code class="xref any py py-func docutils literal notranslate"><span class="pre">write_hdf_files</span></code></a> function uses this approach.</p>
</section>
<section id="remove-the-panda-webcontrol-package">
<h3>Remove the panda-webcontrol package<a class="headerlink" href="#remove-the-panda-webcontrol-package" title="Link to this heading">#</a></h3>
<p>The measures above should get you to about 50MBytes/s, but if more clients
connect to the web GUI then this will drop. To increase the data rate to
60MBytes/s and improve stability you may want to remove the panda-webcontrol
zpkg.</p>
</section>
<section id="flush-about-1hz">
<h3>Flush about 1Hz<a class="headerlink" href="#flush-about-1hz" title="Link to this heading">#</a></h3>
<p><a class="reference internal" href="../reference/api.html#pandablocks.asyncio.AsyncioClient.data" title="pandablocks.asyncio.AsyncioClient.data"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">AsyncioClient.data</span></code></a> accepts a <code class="docutils literal notranslate"><span class="pre">flush_period</span></code> argument. If given, it will
squash intermediate data frames together until this period expires, and only
then produce them. This means the numpy data blocks are larger and can be more
efficiently written to disk then flushed. The <a class="reference internal" href="../reference/api.html#pandablocks.hdf.write_hdf_files" title="pandablocks.hdf.write_hdf_files"><code class="xref any py py-func docutils literal notranslate"><span class="pre">write_hdf_files</span></code></a> function uses
this approach.</p>
</section>
</section>
<section id="performance-achieved">
<h2>Performance Achieved<a class="headerlink" href="#performance-achieved" title="Link to this heading">#</a></h2>
<p>Tests were run with the following conditions:</p>
<ul class="simple">
<li><p>8-core Intel i7 machine as client</p></li>
<li><p>Version 2.1 of panda-server installed on PandA</p></li>
<li><p>PandA and client machine connected to same Gigabit ethernet switch</p></li>
<li><p>60 byte sample payload</p></li>
<li><p>Using the commandline pandablocks hdf utility to write data to an SSD</p></li>
</ul>
<p>When panda-webcontrol is installed with a single browser connected, the following results
were achieved:</p>
<ul class="simple">
<li><p>50MBytes/s throughput</p></li>
<li><p>PandA CPU usage about 75% (of both cores)</p></li>
<li><p>local client CPU usage about 55% (of a single core)</p></li>
</ul>
<p>When panda-webcontrol was not installed, the following results were achieved:</p>
<ul class="simple">
<li><p>60MBytes/s throughput</p></li>
<li><p>PandA CPU usage about 65% (of both cores)</p></li>
<li><p>local client CPU usage about 60% (of a single core)</p></li>
</ul>
<p>Increasing above these throughputs failed most scans with <a class="reference internal" href="../reference/api.html#pandablocks.responses.EndReason.DATA_OVERRUN" title="pandablocks.responses.EndReason.DATA_OVERRUN"><code class="xref any py py-attr docutils literal notranslate"><span class="pre">DATA_OVERRUN</span></code></a>.</p>
</section>
<section id="data-overruns">
<h2>Data overruns<a class="headerlink" href="#data-overruns" title="Link to this heading">#</a></h2>
<p>If there is a <a class="reference internal" href="../reference/api.html#pandablocks.responses.EndReason.DATA_OVERRUN" title="pandablocks.responses.EndReason.DATA_OVERRUN"><code class="xref any py py-attr docutils literal notranslate"><span class="pre">DATA_OVERRUN</span></code></a>, the server will stop sending data. The most recently
received <a class="reference internal" href="../reference/api.html#pandablocks.responses.FrameData" title="pandablocks.responses.FrameData"><code class="xref any py py-class docutils literal notranslate"><span class="pre">FrameData</span></code></a> from either <a class="reference internal" href="../reference/api.html#pandablocks.asyncio.AsyncioClient.data" title="pandablocks.asyncio.AsyncioClient.data"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">AsyncioClient.data</span></code></a> or <a class="reference internal" href="../reference/api.html#pandablocks.blocking.BlockingClient.data" title="pandablocks.blocking.BlockingClient.data"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">BlockingClient.data</span></code></a> may
be corrupt. This is the case if the <code class="docutils literal notranslate"><span class="pre">scaled</span></code> argument is set to False. The mechanism
the server uses to send raw unscaled data is only able to detect the corrupt frame after
it has already been sent. Conversely, the mechanism used to send scaled data aborts prior
to sending a corrupt frame.</p>
<p>The <a class="reference internal" href="../reference/api.html#pandablocks.hdf.write_hdf_files" title="pandablocks.hdf.write_hdf_files"><code class="xref any py py-func docutils literal notranslate"><span class="pre">write_hdf_files</span></code></a> function uses <code class="docutils literal notranslate"><span class="pre">scaled=False</span></code>, so your HDF file may include some
corrupt data in the event of an overrun.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="docs-structure.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">About the documentation</p>
      </div>
    </a>
    <a class="right-next"
       href="sans-io.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Why write a Sans-IO library?</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factors-to-consider">Factors to consider</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#strategies-to-help">Strategies to help</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#average-the-data">Average the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scale-the-data-on-the-client">Scale the data on the client</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-the-panda-webcontrol-package">Remove the panda-webcontrol package</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flush-about-1hz">Flush about 1Hz</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#performance-achieved">Performance Achieved</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-overruns">Data overruns</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  
  <div class="tocsection editthispage">
    <a href="https://github.com/PandABlocks/PandABlocks-client/edit/0.6/docs/user/explanations/performance.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/user/explanations/performance.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      Â© Copyright 2020, Diamond Light Source.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>